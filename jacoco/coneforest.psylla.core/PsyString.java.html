<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PsyString.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Psylla v0.23.6</a> &gt; <a href="index.source.html" class="el_package">coneforest.psylla.core</a> &gt; <span class="el_source">PsyString.java</span></div><h1>PsyString.java</h1><pre class="source lang-java linenums">package coneforest.psylla.core;

import coneforest.psylla.runtime.*;

/**
*	The representation of {@code string}, an immutable string.
*/
@Type(&quot;string&quot;)
public class PsyString
	implements PsyTextual, PsyValue, PsyConcatenable&lt;PsyString&gt;
{
	protected final String string;

	/**
	*	Instantiate a new {@code string} object from the given value.
	*
	*	@param cs a given value.
	*/
	public PsyString(final CharSequence cs)
<span class="fc" id="L20">	{</span>
<span class="fc" id="L21">		string=cs.toString();</span>
<span class="fc" id="L22">	}</span>

	/**
	*	Instantiate a new {@code string} object from the value given as {@code textual} object.
	*
	*	@param oTextual a {@code textual} object.
	*/
	public PsyString(final PsyTextual oTextual)
	{
<span class="nc" id="L31">		this(oTextual.stringValue());</span>
<span class="nc" id="L32">	}</span>

	/**
	*	{@return a string value of this object}
	*/
	@Override
	public String stringValue()
	{
<span class="fc" id="L40">		return string;</span>
	}

	@Override
	public PsyStringBuffer psyToStringBuffer()
	{
<span class="nc" id="L46">		return new PsyStringBuffer(string);</span>
	}

	/**
	*	@return an {@code integer} length (in characters) of this {@code string}.
	*/
	@Override
	public PsyInteger psyLength()
	{
<span class="fc" id="L55">		return PsyInteger.of(string.length());</span>
	}

	@Override
	public PsyString psyConcat(final PsyString oString)
	{
<span class="fc" id="L61">		return new PsyString(string+oString.string);</span>
	}

	/**
	*	Converts all of the characters in this object to upper case according to default locale and
	*	returns a new {@code string} object representing the result of the conversion.
	*
	*	@return a {@code string} result of upper-casing.
	*/
	@Override
	public PsyString psyUpperCase()
	{
<span class="fc" id="L73">		return new PsyString(string.toUpperCase());</span>
	}

	/**
	*	Converts all of the characters in this object to lower case according to default locale and
	*	returns a new {@code string} object representing the result of the conversion.
	*
	*	@return a {@code string} result of lower-casing.
	*/
	@Override
	public PsyString psyLowerCase()
	{
<span class="fc" id="L85">		return new PsyString(string.toLowerCase());</span>
	}

	/**
	*	{@return a syntactic representation of this object’s value} Returns a value string prepended
	*	with {@code /}.
	*/
	@Override
	public String toSyntaxString()
	{
<span class="fc bfc" id="L95" title="All 2 branches covered.">		if(string.length()==0)</span>
<span class="fc" id="L96">			return &quot;''&quot;;</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">		if(string.length()==1)</span>
		{
<span class="fc" id="L99">			final char c=string.charAt(0);</span>
<span class="pc bpc" id="L100" title="19 of 24 branches missed.">			return (c&gt;='A' &amp;&amp; c&lt;='Z'</span>
					|| c&gt;='a' &amp;&amp; c&lt;='z'
					|| c=='['
					|| c==']'
					|| c=='&lt;'
					|| c=='&gt;'
					|| c=='('
					|| c==')'
					|| c=='?'
<span class="pc" id="L109">					|| c=='=')? &quot;/&quot;+string: &quot;'&quot;+string+&quot;'&quot;;</span>
		}
<span class="fc" id="L111">		boolean slashed=true;</span>
<span class="fc bfc" id="L112" title="All 4 branches covered.">		if(string.charAt(0)&gt;='0' &amp;&amp; string.charAt(0)&lt;='9')</span>
<span class="fc" id="L113">			slashed=false;</span>
		else
		{
<span class="fc bfc" id="L116" title="All 2 branches covered.">			for(int i=0; i&lt;string.length(); i++)</span>
			{
<span class="fc" id="L118">				final char c=string.charAt(i);</span>
<span class="pc bpc" id="L119" title="5 of 24 branches missed.">				slashed=c&gt;='0' &amp;&amp; c&lt;='9'</span>
						|| c&gt;='A' &amp;&amp; c&lt;='Z'
						|| c&gt;='a' &amp;&amp; c&lt;='z'
						|| c=='_'
						|| c=='.'
						|| c=='-'
						|| c=='+'
						|| c=='='
						|| c=='$';
<span class="fc bfc" id="L128" title="All 2 branches covered.">				if(!slashed)</span>
<span class="fc" id="L129">					break;</span>
			}
		}
		// TODO
<span class="fc bfc" id="L133" title="All 2 branches covered.">		if(slashed)</span>
<span class="fc" id="L134">			return &quot;/&quot;+string;</span>
		else
		{
<span class="fc" id="L137">			final var sb=new StringBuilder(&quot;'&quot;);</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">			for(int i=0; i&lt;string.length(); i++)</span>
			{
<span class="fc" id="L140">				final char c=string.charAt(i);</span>
<span class="fc bfc" id="L141" title="All 11 branches covered.">				sb.append(switch(c)</span>
					{
<span class="fc" id="L143">						case '\u0000'-&gt;&quot;\\0&quot;;</span>
<span class="fc" id="L144">						case '\u0007'-&gt;&quot;\\a&quot;;</span>
<span class="fc" id="L145">						case '\n'-&gt;&quot;\\n&quot;;</span>
<span class="fc" id="L146">						case '\r'-&gt;&quot;\\r&quot;;</span>
<span class="fc" id="L147">						case '\t'-&gt;&quot;\\t&quot;;</span>
<span class="fc" id="L148">						case '\u000B'-&gt;&quot;\\v&quot;;</span>
<span class="fc" id="L149">						case '\f'-&gt;&quot;\\f&quot;;</span>
<span class="fc" id="L150">						case '\u001B'-&gt;&quot;\\e&quot;;</span>
<span class="fc" id="L151">						case '\&quot;'-&gt;&quot;\\\&quot;&quot;;</span>
<span class="fc" id="L152">						case '\\'-&gt;&quot;\\\\&quot;;</span>
<span class="fc" id="L153">						default-&gt;c;</span>
					});
			}
<span class="fc" id="L156">			sb.append(&quot;'&quot;);</span>
<span class="fc" id="L157">			return sb.toString();</span>
		}
	}

	/**
	*	{@return a {@code boolean} object indicating whether some other object is “equal to” this
	*	one} Return value is {@code true} if and only if other object has {@code string} type and
	*	its value is equal to this one’s.
	*/
	@Override
	public boolean equals(final Object object)
	{
<span class="fc" id="L169">		return object instanceof PsyString oString</span>
<span class="pc bpc" id="L170" title="2 of 4 branches missed.">				&amp;&amp; string.equals(oString.string);</span>
	}

	@Override
	public int hashCode()
	{
<span class="fc" id="L176">		return string.hashCode();</span>
	}

	public static PsyString parseLiteral(final String image)
		throws PsySyntaxErrorException
	{
<span class="fc bfc" id="L182" title="All 2 branches covered.">		if(image.charAt(0)=='/')</span>
<span class="fc" id="L183">			return new PsyString(image.substring(1).intern());</span>
<span class="fc" id="L184">		final var sb=new StringBuilder();</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">		for(int i=1; i&lt;image.length()-1; i++)</span>
		{
<span class="fc" id="L187">			final var c=image.charAt(i);</span>
<span class="fc bfc" id="L188" title="All 2 branches covered.">			switch(c)</span>
			{
				case '\\':
<span class="pc bpc" id="L191" title="2 of 18 branches missed.">					switch(image.charAt(++i))</span>
					{
<span class="fc" id="L193">						case '0'-&gt;sb.append('\u0000');</span>
<span class="fc" id="L194">						case 'a'-&gt;sb.append('\u0007');</span>
<span class="fc" id="L195">						case 'n'-&gt;sb.append('\n');</span>
<span class="fc" id="L196">						case 'r'-&gt;sb.append('\r');</span>
<span class="fc" id="L197">						case 't'-&gt;sb.append('\t');</span>
<span class="fc" id="L198">						case 'v'-&gt;sb.append('\u000B');</span>
<span class="fc" id="L199">						case 'f'-&gt;sb.append('\f');</span>
<span class="fc" id="L200">						case 'e'-&gt;sb.append('\u001B');</span>
<span class="fc" id="L201">						case '&quot;'-&gt;sb.append('&quot;');</span>
<span class="nc" id="L202">						case '\''-&gt;sb.append('\'');</span>
<span class="fc" id="L203">						case '\\'-&gt;sb.append('\\');</span>
<span class="fc" id="L204">						case '\n'-&gt;{}</span>
						case 'u'-&gt;
							{
<span class="fc" id="L207">								sb.append(Character.toChars(Integer.valueOf(image.substring(i+1, i+5), 16)));</span>
<span class="fc" id="L208">								i+=4;</span>
<span class="fc" id="L209">							}</span>
						case 'c'-&gt;
							{
<span class="fc" id="L212">								final var ch=image.charAt(++i);</span>
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">								sb.append(Character.toChars(ch+(ch&lt;64? 64: -64)));</span>
<span class="fc" id="L214">							}</span>
						case 'x'-&gt;
							{
								try
								{
<span class="fc" id="L219">									final var j=image.indexOf('}', i+2);</span>
<span class="fc" id="L220">									sb.append(Character.toChars(Integer.valueOf(image.substring(i+2, j), 16)));</span>
<span class="fc" id="L221">									i=j;</span>
								}
<span class="nc" id="L223">								catch(final IllegalArgumentException ex)</span>
								{
<span class="nc" id="L225">									throw new PsySyntaxErrorException();</span>
<span class="fc" id="L226">								}</span>
							}
						case 'o'-&gt;
							{
								try
								{
<span class="fc" id="L232">									final var j=image.indexOf('}', i+2);</span>
<span class="fc" id="L233">									sb.append(Character.toChars(Integer.valueOf(image.substring(i+2, j), 8)));</span>
<span class="fc" id="L234">									i=j;</span>
								}
<span class="nc" id="L236">								catch(final IllegalArgumentException ex)</span>
								{
<span class="nc" id="L238">									throw new PsySyntaxErrorException();</span>
<span class="fc" id="L239">								}</span>
							}
						case 'N'-&gt;
							{
								try
								{
<span class="fc" id="L245">									final var j=image.indexOf('}', i+2);</span>
<span class="fc" id="L246">									final var cp=Character.codePointOf(image.substring(i+2, j));</span>
									// TODO
<span class="fc" id="L248">									sb.append((char)cp);</span>
<span class="fc" id="L249">									i=j;</span>
								}
<span class="fc" id="L251">								catch(final IllegalArgumentException ex)</span>
								{
<span class="fc" id="L253">									throw new PsySyntaxErrorException();</span>
<span class="fc" id="L254">								}</span>
							}
					}
<span class="fc" id="L257">					break;</span>
				default:
<span class="fc" id="L259">					sb.append(c);</span>
					break;
			}
		}
<span class="fc" id="L263">		return new PsyString(sb.toString().intern());</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202410190809</span></div></body></html>